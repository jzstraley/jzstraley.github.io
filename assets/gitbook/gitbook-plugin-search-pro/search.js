require(["gitbook","jquery"],function(e,t){var n,a,r,s,o,i=e.state,l={},u=void 0!==history.pushState,c=t("body");function h(e){return String(e).replace(/([\*\.\?\+\$\^\[\]\(\)\{\}\|\/\\])/g,"\\$1")}function p(e){var i,u;c.addClass("with-search"),c.addClass("search-loading"),(i=function i(){(function e(i){if(null!=i&&""!==i.trim()){var u,c,p=[],d=-1;for(var f in l)-1!==(d=l[f].body.toLowerCase().indexOf(i.toLowerCase()))&&p.push({url:f,title:l[f].title,body:l[f].body.substr(Math.max(0,d-50),500).replace(RegExp("("+h(i)+")","gi"),'<span class="search-highlight-keyword">$1</span>')});u={count:p.length,query:i,results:p},a=(n=t("#book-search-results")).find(".search-results-list"),s=(r=n.find(".search-results-title")).find(".search-results-count"),o=r.find(".search-query"),n.addClass("open"),c=0==u.count,n.toggleClass("no-results",c),a.empty(),s.text(u.count),o.text(u.query),u.results.forEach(function(e){var n=t("<li>",{class:"search-results-item"}),r=t("<h3>"),s=t("<a>",{href:e.url+"?h="+encodeURIComponent(u.query),text:e.title,"data-is-search":1});s[0].href.split("?")[0]===location.href.split("?")[0]&&s[0].setAttribute("data-need-reload",1);var o=e.body.trim();o.length>500&&(o+="...");var i=t("<p>").html(o);s.appendTo(r),r.appendTo(n),i.appendTo(n),n.appendTo(a)}),t(".body-inner").scrollTop(0)}})(e),c.removeClass("search-loading")},function(){var e=this,t=arguments;u||(u=setTimeout(function(){u=null,i.apply(e,t)},void 0))})()}function d(){c.removeClass("with-search"),t("#book-search-results").removeClass("open")}function f(e){var n=i.basePath+"/assets/search_plus_index.json";t.getJSON(n).then(function(e){l=e,r()});var a=t("body");function r(){var n=t(e).val();void 0===n||0==n.length?d():p(n)}a.on("keyup",e,function(e){if(13===e.keyCode&&u){var n=b("q",t(this).val());history.pushState({path:n},null,n)}r()}),a.on("click",e,function(e){if(0===Object.keys(l).length){var n=i.basePath+"/assets/search_plus_index.json";t.getJSON(n).then(function(e){l=e,r()})}}),a.on("blur",e,function(e){if(u){var n=b("q",t(this).val());history.pushState({path:n},null,n)}})}e.events.on("start",function(){f("#book-search-input input"),f("#book-search-input-inside input"),$(),d()});var v=function(e){t(".page-inner").mark(e,{ignoreJoiners:!0,acrossElements:!0,separateWordSearch:!1}),setTimeout(function(){var e=t('mark[data-markjs="true"]');e.length&&e[0].scrollIntoView()},100)};function $(){var e,n;/\b(q|h)=([^&]+)/.test(location.search)&&(n=RegExp.$1,e=decodeURIComponent(RegExp.$2),"q"===n?p(e):v(e),t("#book-search-input input").val(e),t("#book-search-input-inside input").val(e))}function g(e){var t=window.location.href,n=RegExp("[?&]"+(e=e.replace(/[\[\]]/g,"\\$&"))+"(=([^&#]*)|&|#|$)","i").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}function b(e,t){t=encodeURIComponent(t);var n,a=window.location.href.replace(/([?&])(?:q|h)=([^&]+)(&|$)/,function(e,t,n,a){return"&"===a?t:""}),r=RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(r.test(a))return null!=t?a.replace(r,"$1"+e+"="+t+"$2$3"):(a=(n=a.split("#"))[0].replace(r,"$1$3").replace(/(&|\?)$/,""),void 0!==n[1]&&null!==n[1]&&(a+="#"+n[1]),a);if(null==t)return a;var s=-1!==a.indexOf("?")?"&":"?";return a=(n=a.split("#"))[0]+s+e+"="+t,void 0!==n[1]&&null!==n[1]&&(a+="#"+n[1]),a}e.events.on("page.change",$),window.addEventListener("click",function(e){"A"===e.target.tagName&&e.target.getAttribute("data-need-reload")&&setTimeout(function(){location.reload()},100)},!0)});